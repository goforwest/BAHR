# Classical Arabic Prosody - Tafa'il Reference

**Purpose**: Authoritative reference for tafa'il (prosodic feet) patterns in classical Arabic poetry meters.

**Date**: 2025-11-11  
**Source**: Golden dataset analysis + Classical Arabic prosody rules

---

## Pattern Notation

- `/` = haraka (short vowel - fatha, damma, kasra)
- `o` = sakin (sukun or long vowel continuation)
- `/o` = long vowel (haraka followed by long alef, waw, ya, or sukun)

**Example**: `//o/o` = "فَعُولُنْ" (fa-'uu-lun)
- `//` = two short vowels (فَعُ)
- `o` = long vowel continuation (و)
- `/o` = short + sukun (لُنْ)

---

## The Nine Classical Meters (البحور التسعة)

### 1. الطويل (al-Tawil) - "The Long"

**Pattern**: فَعُولُنْ مَفَاعِيلُنْ فَعُولُنْ مَفَاعِيلُنْ

**Standard Tafail**:
- `فَعُولُنْ` (fa-'uu-lun) - Primary foot
  - Phonetic: `//o/o`
  
- `مَفَاعِيلُنْ` (ma-faa-'ii-lun) - Primary foot
  - Phonetic: `//o/o/o`

**Common Variations (Zihafat)**:
- `مَفَاعِلُنْ` (ma-faa-'i-lun) - خبن in مفاعيلن
  - Phonetic: `///o/o`
  
**Golden Dataset Evidence**:
- 11/11 verses use: فَعُولُنْ + مَفَاعِيلُنْ (or مَفَاعِلُنْ)
- Ending variations: مَفَاعِيلُنْ or مَفَاعِلُنْ

---

### 2. الكامل (al-Kamil) - "The Perfect"

**Pattern**: مُتَفَاعِلُنْ مُتَفَاعِلُنْ مُتَفَاعِلُنْ

**Standard Tafail**:
- `مُتَفَاعِلُنْ` (mu-ta-faa-'i-lun) - Primary foot
  - Phonetic: `///o//o`

**Golden Dataset Evidence**:
- 9/9 verses use: مُتَفَاعِلُنْ × 3
- Very consistent, minimal variations

---

### 3. الوافر (al-Wafir) - "The Abundant"

**Pattern**: مُفَاعَلَتُنْ مُفَاعَلَتُنْ فَعُولُنْ

**Standard Tafail**:
- `مُفَاعَلَتُنْ` (mu-faa-'a-la-tun) - Primary foot
  - Phonetic: `//o///o`
  
- `فَعُولُنْ` (fa-'uu-lun) - Ending foot
  - Phonetic: `//o/o`

**Golden Dataset Evidence**:
- 10/10 verses use: مُفَاعَلَتُنْ مُفَاعَلَتُنْ فَعُولُنْ
- No variations observed

---

### 4. الرمل (al-Ramal) - "The Sand"

**Pattern**: فَاعِلاتُنْ فَاعِلاتُنْ فَاعِلاتُنْ / فَاعِلُنْ

**Standard Tafail**:
- `فَاعِلاتُنْ` (faa-'i-laa-tun) - Primary foot
  - Phonetic: `/o//o/o`
  
- `فَاعِلُنْ` (faa-'i-lun) - Ending foot (truncated)
  - Phonetic: `/o//o`

**Golden Dataset Evidence**:
- Pattern A: فَاعِلاتُنْ × 3 (full verses)
- Pattern B: فَاعِلاتُنْ × 2 + فَاعِلُنْ (common ending)
- 8/8 verses confirmed

---

### 5. البسيط (al-Basit) - "The Simple"

**Pattern**: مُسْتَفْعِلُنْ فَاعِلُنْ مُسْتَفْعِلُنْ فَاعِلُنْ

**Standard Tafail**:
- `مُسْتَفْعِلُنْ` (mus-taf-'i-lun) - Primary foot
  - Phonetic: `/o/o//o`
  
- `فَاعِلُنْ` (faa-'i-lun) - Alternating foot
  - Phonetic: `/o//o`

**Common Variations**:
- `فَعِلُنْ` (fa-'i-lun) - خبن in فاعلن
  - Phonetic: `///o`

**Golden Dataset Evidence**:
- 11/11 verses use: مُسْتَفْعِلُنْ فَاعِلُنْ pattern
- Ending can be فَاعِلُنْ or فَعِلُنْ

---

### 6. المتقارب (al-Mutaqarib) - "The Convergent"

**Pattern**: فَعُولُنْ فَعُولُنْ فَعُولُنْ فَعُولُنْ

**Standard Tafail**:
- `فَعُولُنْ` (fa-'uu-lun) - Repeated foot
  - Phonetic: `//o/o`

**Golden Dataset Evidence**:
- 8/8 verses use: فَعُولُنْ × 4
- Very simple, consistent pattern

---

### 7. الرجز (al-Rajaz) - "The Trembling"

**Pattern**: مُسْتَفْعِلُنْ مُسْتَفْعِلُنْ مُسْتَفْعِلُنْ

**Standard Tafail**:
- `مُسْتَفْعِلُنْ` (mus-taf-'i-lun) - Repeated foot
  - Phonetic: `/o/o//o`

**Golden Dataset Evidence**:
- 8/8 verses use: مُسْتَفْعِلُنْ × 3
- No variations observed

---

### 8. الهزج (al-Hazaj) - "The Rhythmic"

**Pattern**: مَفَاعِيلُنْ مَفَاعِيلُنْ (فَعُولُنْ)

**Standard Tafail**:
- `مَفَاعِيلُنْ` (ma-faa-'ii-lun) - Primary foot
  - Phonetic: `//o/o/o`
  
- `فَعُولُنْ` (fa-'uu-lun) - Optional ending
  - Phonetic: `//o/o`

**Golden Dataset Evidence**:
- Pattern A: مَفَاعِيلُنْ × 2 + فَعُولُنْ (5 verses)
- Pattern B: مَفَاعِيلُنْ × 2 (2 verses - truncated)
- 7/7 verses confirmed

---

### 9. الخفيف (al-Khafif) - "The Light"

**Pattern**: فَاعِلاتُنْ مُسْتَفْعِلُنْ فَاعِلاتُنْ

**Standard Tafail**:
- `فَاعِلاتُنْ` (faa-'i-laa-tun) - Outer feet
  - Phonetic: `/o//o/o`
  
- `مُسْتَفْعِلُنْ` (mus-taf-'i-lun) - Middle foot
  - Phonetic: `/o/o//o`

**Common Variations**:
- `فَاعِلُنْ` (faa-'i-lun) - Ending variation
  - Phonetic: `/o//o`

**Golden Dataset Evidence**:
- 8/8 verses use: فَاعِلاتُنْ مُسْتَفْعِلُنْ (فَاعِلاتُنْ or فَاعِلُنْ)
- Ending can vary

---

## Key Findings

### Shared Tafail Across Meters

**CRITICAL INSIGHT**: The same tafila can appear in different meters!

1. **فَعُولُنْ** (`//o/o`) appears in:
   - الطويل (primary)
   - المتقارب (repeated)
   - الوافر (ending)
   - الهزج (ending)

2. **مَفَاعِيلُنْ** (`//o/o/o`) appears in:
   - الطويل (primary)
   - الهزج (primary)

3. **مُسْتَفْعِلُنْ** (`/o/o//o`) appears in:
   - البسيط (alternating with فاعلن)
   - الرجز (repeated)
   - الخفيف (middle position)

4. **فَاعِلاتُنْ** (`/o//o/o`) appears in:
   - الرمل (primary)
   - الخفيف (outer positions)

5. **فَاعِلُنْ** (`/o//o`) appears in:
   - البسيط (alternating with مستفعلن)
   - الرمل (ending)
   - الخفيف (ending variation)

---

## Implications for Taqti3 Algorithm

### Problem
The current `BASIC_TAFAIL` dictionary has a **one-to-one mapping** of patterns to tafail. This fails because:

1. Same phonetic pattern can be different tafail in different meters
2. Pattern matching is context-free (doesn't know which meter)
3. Greedy matching picks first match, which may be wrong

### Solution
**Meter-aware scansion**: The taqti3 algorithm must know which meter (bahr) it's analyzing to select the correct tafail sequence.

**Example**:
- Pattern `//o/o` in **الطويل** → scan as "فَعُولُنْ ... مَفَاعِيلُنْ"
- Pattern `//o/o` in **المتقارب** → scan as "فَعُولُنْ فَعُولُنْ فَعُولُنْ"
- Pattern `//o/o` in **الوافر** → scan as "مُفَاعَلَتُنْ ... فَعُولُنْ"

---

## Next Steps

1. ✅ **Task 3 COMPLETE**: Research classical prosody rules
2. **Task 2**: Audit current BASIC_TAFAIL against this reference
3. **Task 1**: Extract actual phonetic patterns from golden dataset
4. **Implementation**: Build meter-specific TAFAIL_BY_BAHR dictionary
5. **Testing**: Validate on 80-verse golden dataset

---

## References

- Golden dataset: `dataset/evaluation/golden_set_v0_80_complete.jsonl`
- Current implementation: `backend/app/core/taqti3.py`
- Classical Arabic prosody: Standard العروض references
