# Railway deployment configuration for BAHR Platform
# This file configures deployment settings for both backend and frontend services

[build]
builder = "NIXPACKS"

# Backend Service Configuration
[backend.build]
buildCommand = "cd backend && pip install --upgrade pip && pip install -r requirements.txt"

[backend.deploy]
startCommand = "cd backend && uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000}"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Frontend Service Configuration  
[frontend.build]
buildCommand = "cd frontend && npm ci && npm run build"

[frontend.deploy]
startCommand = "cd frontend && npm start"
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Environment Variables Configuration
# Set these in Railway dashboard for each service:
#
# Backend Service Environment Variables:
# - PROJECT_NAME=BAHR API
# - API_VERSION=1.0.0
# - SECRET_KEY=<generate-with-openssl-rand-hex-32>
# - DATABASE_URL=<railway-postgres-url>
# - REDIS_URL=<railway-redis-url>
# - CACHE_TTL=86400
# - CORS_ORIGINS=<frontend-url>,<backend-url>
# - ENVIRONMENT=staging
# - LOG_LEVEL=INFO
#
# Frontend Service Environment Variables:
# - NEXT_PUBLIC_API_URL=<backend-url>/api/v1
# - NODE_ENV=production
